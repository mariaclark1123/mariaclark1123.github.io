<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no"/>
    <title>OpenGL - Lighting, material and color</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<html>

<body>
    <div class="container">
        <hr>
        <h1>OpenGL - Lighting, material and color</h1>
        <hr>
        <br>
        <p>现实世界的光照是极其复杂的，而且会受到诸多因素的影响，这是以目前我们所拥有的处理能力无法模拟的。因此OpenGL的光照仅仅使用了简化的模型并基于对现实的估计来进行模拟，这样处理起来会更容易一些，而且看起来也差不多一样。这些光照模型都是基于我们对光的物理特性的理解。其中一个模型被称为冯氏光照模型(Phong Lighting Model)。冯氏光照模型的主要结构由3个元素组成：环境(Ambient)、漫反射(Diffuse)和镜面(Specular)光照。这些光照元素看起来像下面这样：</p>
        <div class="clearfix"><img align=middle src="basic_lighting_phong.png"></div>
        <ul>
            <li> 环境光照(Ambient Lighting)：即使在黑暗的情况下，世界上也仍然有一些光亮(月亮、一个来自远处的光)，所以物体永远不会是完全黑暗的。我们使用环境光照来模拟这种情况，也就是无论如何永远都给物体一些颜色。</li>
            <li> 漫反射光照(Diffuse Lighting)：模拟一个发光物对物体的方向性影响(Directional Impact)。它是冯氏光照模型最显著的组成部分。面向光源的一面比其他面会更亮。</li>
            <li> 镜面光照(Specular Lighting)：模拟有光泽物体上面出现的亮点。镜面光照的颜色，相比于物体的颜色更倾向于光的颜色。</li>
        </ul>
        <br>
        
        <p>
            OpenGL场景中模型颜色的产生，大致为如下的流程图所描述：
        </p>
        <br>
        <div class = "clearfix"><img align=left src="example1.png"></div>
    
        <p style="color:red;">(1) 当不开启光照时，使用顶点颜色来产生整个表面的颜色 (ex: glColor3f(1,0,1.0,1.0))</p>
        <p>用glShadeModel可以设置表面内部像素颜色产生的方式: GL_FLAT/GL_SMOOTH.</p>
        <br>

        <p style="color:red;">(2)一般而言，开启光照后，在场景中至少需要有一个光源（GL_LIGHT0...GL_LIGHT7）</p>
        <p>通过glEnable(GL_LIGHT0)  glDisable(GL_LIGHT0) 来开启和关闭指定的光源。</p>
        <p>---  全局环境光 ---</p>
        <pre>
            <code class="javascript highlight">
 GLfloat glAmbient[] = {0.6, 0,6, 0,6, 1.0};
 glLightModelfv(GL_LIGHT_MODEL_AMBIENT, gAmbient);
             </code>
        </pre>
        <br>
        
        <p style="color:red;">(3)设置光源的光分量  -- 环境光/漫色光/镜面光</p>
        <p> 默认情况下：</p>
        <ul>
            <li> GL_LIGHT0...GL_LIGHT7 的GL_AMBIENT值为(0.0, 0.0, 0.0, 1.0)</li>
            <li> GL_LIGHT0的GL_DIFFUSE和GL_SPECULAR值为(1.0, 1.0, 1.0, 1.0)</li>
            <li> GL_LIGHT1...GL_LIGHT7 的GL_DIFFUSE和GL_SPECULAR值为(0.0, 0.0, 0.0, 0.0)。</li>
        </ul>
        <p> 所以我们需要自己定义光源的光分量：</p>
        <pre>
            <code class="javascript highlight">
 GLfloat lightAmbient[] = {1.0, 1.0, 1.0, 1.0};
 GLfloat lightDiffuse[]   = {1.0, 1.0, 1.0, 1.0};
 GLfloat lightSpecular[] = {0.5, 0.5, 0.5, 1.0};
 glLightfv(GL_LIGHT0, GL_AMBIENT, lightAmbient);
 glLightfv(GL_LIGHT0, GL_DIFFUSE, lightDiffuse);
 glLightfv(GL_LIGHT0, GL_SPECULAR, lightSpecular);
             </code>
        </pre>
        <br>
       
        <p style="color:red;">(4)设置光源的位置和方向</p>
        <p> -- 平行光 --         没有位置只有方向 (w = 0)</p>
        <pre>
             <code class="javascript highlight">
 GLfloat lightPosition[] = {8.5, 5.0, -2.0, 0.0};   // w=0.0
 glLightfv(GL_LIGHT0, GL_POSITION, lightPosition);
             </code>
        </pre>
        <br>

        <p> -- 点光源 --          有位置没有方向 (w != 0)</p>
        <pre>
             <code class="javascript highlight">
 GLfloat lightPosition[] = {8.5, 5.0, -2.0, 1.0};   // w不为0
 glLightfv(GL_LIGHT0, GL_POSITION, lightPosition);
             </code>
        </pre>
        <br>

        <p> -- 聚光灯 --          有位置有方向 (w != 0)</p>
        <div class = "clearfix"><img align=left src="spotlight.png"></div>
        <pre>
        <code class="javascript highlight">
 GLfloat lightPosition[] = {-6.0, 1.0, 3.0, 1.0};   // w不为0
 glLightfv(GL_LIGHT0, GL_POSITION, lightPosition);
 GLfloat lightDirection[] = {1.0, 1.0, 0.0};
 glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, lightDirection);  // 聚光灯主轴方向  spot direction
 glLightf(GL_LIGHT0, GL_SPOT_CUTOFF, 45.0);   // cutoff角度  spot cutoff
             </code>
        </pre>
        <br>
        <p style="color:red;">** 平行光不会随着距离d增加而衰减，但点光源和聚光灯会发生衰减 **</p>
        <div class = "clearfix"><img align=left src="atten_eq.png"></div>
        <p>attenuation为衰变系数，系数值越大，衰变越快。</p>
        <p> 默认情况下，c=1.0, l=0.0, q=0.0</p>
        <div class = "clearfix"><img align=left src="atten_pic.png"></div>
        <p>可以自定义衰变函数的系数</p>
        <pre>
        <code class="javascript highlight">
 glLightf(GL_LIGHT0, GL_CONSTANT_ATTENUATION, 2.0);     // c 系数
 glLightf(GL_LIGHT0, GL_LINEAR_ATTENUATION, 1.0);        // l 系数
 glLightf(GL_LIGHT0, GL_QUADRATIC_ATTENUATION, 0.5);    // q 系数
             </code>
        </pre>
        <br>

        <p style="color:red;">(5)设置材质属性</p>
        <p>环境光、散射光不受视点位置的影响。物体看起来是什么颜色，很大程度上地受到散射光的影响，环境光反射也对物体的颜色有一定的影响。 因为当光直射物体时，散射光最强；非直射时，环境光效果明显。对于真实的世界中的物体，其散射光与环境光通常是同一个颜色。物体的镜面反射会在物体表面产生一个高亮区。观察者所看到的镜面反射依赖于视点位置 -- 沿着反射光的方向亮度最高。</p>
        <br>
        <p>默认情况下:</p>
        <ul>
            <li> 材质的GL_AMBIENT值为(0.2, 0.2, 0.2, 1.0)</li>
            <li> 材质的GL_DIFFUSE值为(0.8, 0.8, 0.8, 1.0)</li>
            <li> 材质的GL_SPECULAR值为(0.0, 0.0, 0.0, 1.0)</li>
            <li> 材质的GL_SHININESS值为0.0【取值范围为[0.0, 128.0]，数值越大，高亮区越小，亮度越高】</li>
            <li> 材质的GL_GL_EMISSION值为(0.0, 0.0, 0.0, 1.0)</li>
        </ul>
        <br>
        <pre>
             <code class="javascript highlight">
 GLfloat matAmbient[] = {0.6, 0.6, 0.6, 1.0};
 GLfloat matDiffuse[]   = {0.35, 0.35, 0.35, 1.0};
 GLfloat matAmbDif[]   = {0.5, 0.5, 0.5, 1.0};
 GLfloat matSpecular[] = {0.2, 0.2, 0.2, 1.0};
 GLfloat shine[] = {5.0};
 GLfloat matEmission[] = {0.3, 0.1, 0.1, 1.0};
 glMaterialfv(GL_FRONT_AND_BACK, GL_AMBIENT, matAmbient);
 glMaterialfv(GL_FRONT_AND_BACK, GL_DIFFUSE, matDiffuse);
 glMaterialfv(GL_FRONT_AND_BACK, GL_AMBIENT_AND_DIFFUSE, matAmbDif);  // 将背景颜色和散射颜色设置成同一颜色
 glMaterialfv(GL_FRONT_AND_BACK, GL_SPECULAR, matSpecular);
 glMaterialfv(GL_FRONT, GL_SHININESS, shine);
 glMaterialfv(GL_FRONT, GL_EMISSION, matEmission);  // 用来模拟物体发光的效果，但这不是光源
             </code>
        </pre>
        <br>

        <p style="color:red;">(6)颜色材质模式</p>
        <p>
            使用颜色材质可以用较小的代价，快速改变场景中模型的颜色。其具体用法如下：
        </p>
        <pre>
              <code class="javascript highlight">
 glEnable(GL_COLOR_MATERIAL);
 glColorMaterial(GL_FRONT, GL_DIFFUSE);
 glColor3f(0.2, 0.5, 0.8);
 /*** 绘制一些物体 ***/
 glColorMaterial(GL_FRONT, GL_SPECULAR);
 glColor3f(0.9, 0.1, 0.3);
 /*** 绘制另外一些物体 ***/
 glDisable(GL_COLOR_MATERIAL);
             </code>
        </pre>
        <br>
        <hr>
        <h3>参考文章</h3>
        <ul>
            <li><a href="https://learnopengl-cn.readthedocs.io/zh/latest/02%20Lighting/02%20Basic%20Lighting/"> 光照基础</a></li>
            <li><a href="https://www.sjbaker.org/steve/omniv/opengl_lighting.html"> Basic OpenGL Lighting</a></li>
            <li><a href="http://blog.csdn.net/gamesdev/article/details/9796715"> 浅析OpenGL光照</a></li>
        </ul>
        <hr>
        <p><a href="http://www.cnblogs.com/kekec/archive/2011/08/16/2140789.html">本文转自可可西的博客：http://www.cnblogs.com/kekec/archive/2011/08/16/2140789.html</a></p>
    </div>
</body>
<script src="js/js.js"></script>
<script src="js/jquery-3.2.1.min.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">
<link rel="stylesheet" href="css/solarized-light.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>

<script>
    $(document).ready(function () {
        $('pre code').each(function (i, block) {
            hljs.highlightBlock(block);
        });
    });
</script>
</html>
