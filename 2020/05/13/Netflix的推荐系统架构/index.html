<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="mariaclark1123@outlook.com"><title>Netflix的推荐系统架构 · Fang-da</title><meta name="description" content="这篇文章我们回顾一篇经典博客，Netflix官方博客介绍的推荐系统架构，虽然文章发布已有六年， 但是现在回看起来我自己还是蛮惊讶的，因为Netflix的推荐系统架构居然到现在依然是主流。
当然，框架中的诸多技术在不断的迭代更新，因为近期与Netflix的很多同行有过交流，也可以更新一下框架中一些模块"><meta name="keywords" content="Hexo,HTML,CSS,android,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/judy.jpg" style="width:160px;"><h3 title=""><a href="/" style="font-family:medium-ui-sans-serif-text-font,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,Oxygen,Ubuntu,Cantarell,&quot;Open Sans&quot;,&quot;Helvetica Neue&quot;,sans-serif;">Fang-da</a></h3><div class="description"><p>生活一分一秒的过, 你的斗志不是燃烧一刻，而是要每分每秒的燃烧, 即使不燃烧，至少不能让它熄灭。你要的斗志从来都不在逆境中, 而在你做成一件事后这件事能给你带来的成就感以及未来, 那是能指导你每分每秒都燃烧的火药。</p></div></div></div><ul class="social-links"><li><a href="http://facebook.com/mariaclark1123"><i class="fa fa-facebook"></i></a></li><li><a href="http://github.com/mariaclark1123"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"></a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Theme from Fangda&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/albums">相册</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Netflix的推荐系统架构</a></h3></div><div class="post-content"><p>这篇文章我们回顾一篇经典博客，Netflix官方博客介绍的推荐系统架构，虽然文章发布已有六年， 但是现在回看起来我自己还是蛮惊讶的，因为Netflix的推荐系统架构居然到现在依然是主流。</p>
<p>当然，框架中的诸多技术在不断的迭代更新，因为近期与Netflix的很多同行有过交流，也可以更新一下框架中一些模块的最新进展。</p>
<h3 id="Netflix推荐系统架构图"><a href="#Netflix推荐系统架构图" class="headerlink" title="Netflix推荐系统架构图"></a>Netflix推荐系统架构图</h3><p><img src="https://pic1.zhimg.com/80/v2-5977ad4f475f160d23943cdb0bfb9d2c_1440w.jpg" alt=""></p>
<p>Netflix的推荐系统从上至下依次分为离线（offline）、近线（nearline），在线（online）三部分。</p>
<h4 id="离线（offline）"><a href="#离线（offline）" class="headerlink" title="离线（offline）"></a>离线（offline）</h4><p>存储离线数据，利用大数据查询工具进行数据查询和处理，离线模型训练。离线部分对于数据数量和算法复杂度限制很少，以批量方式完成数据处理，但是数据处理的实时性非常差，无法做到数据和模型的即使更新。</p>
<p>可以看到当时还是hive，pig等工具的天下，现在spark 是主流，但也有越来越多的offline job被合并到near line之中，可以说当前的offline和nearline的界限日渐模糊了。</p>
<h4 id="近线（near-line）"><a href="#近线（near-line）" class="headerlink" title="近线（near line）"></a>近线（near line）</h4><p>基于数据消息队列，利用一些流计算平台进行数据的准实时处理。它居于离线和在线之间，既可以以分钟级别甚至秒级的延时来准实时地处理数据，也有一定的数据批量处理能力。</p>
<p>nearline可以说是近几年大数据架构发展的重中之重了。当时Netflix开发了自己的流处理框架Manhattan，但现在已经是Flink一统天下的时候，Netflix内部的Flink平台每天会运行上千个不同的流处理任务。涵盖了特征实时计算、数据监控、BI、模型实时训练等等。越来越多的offline任务被替代，也许Kappa架构彻底替代Lambda架构的日子不太远了。</p>
<h4 id="在线（online）"><a href="#在线（online）" class="headerlink" title="在线（online）"></a>在线（online）</h4><p>online部分的主要任务是进行用户请求的实时处理，模型的在线服务。在线部分需要更快地响应最近的事件和用户交互，因此对于延迟的要求比较苛刻，一般都要求在100ms以内完成所有处理，这会限制所用算法的复杂性和可处理的数据量。</p>
<p>正是online部分极高的响应延迟要求和相比离线、近线较弱的数据处理能力，要求online部分采用不同的高效的model serving方法去支持个性化推荐服务。这也是前段时间我们专栏花了几篇文章介绍model serving的原因。</p>
<h4 id="AWS"><a href="#AWS" class="headerlink" title="AWS"></a>AWS</h4><p>大家要注意架构图右上角的AWS的标志，它意味着Netflix的所有服务器和大数据设施都是架构在amazon的云平台上的，而且一直沿用至今。作为AWS的第一大用户，Netflix服务的云化还是非常彻底的。</p>
<p>有的时候我也挺佩服美国这些互联网公司的选择，像Netflix、Pinterest这些公司，已经是不折不扣的互联网巨头，居然非常放心的使用AWS，AWS确实能够提供非常专业安全的云服务。这样开放的精神还是让我挺感慨的。国内的阿里云发展当然也非常好，但是巨头级别的公司完全依赖阿里云的案例还是不多，从这一点上，国内和国外整个互联网的氛围还是有一些微妙的区别。</p>
<h4 id="不同层之间的配合与系统的整体性"><a href="#不同层之间的配合与系统的整体性" class="headerlink" title="不同层之间的配合与系统的整体性"></a>不同层之间的配合与系统的整体性</h4><p>可以看到，从离线到在线，数据的实时性从上到下依次增强，而数据规模和处理能力从上到下依次减弱。</p>
<p>但作为同一个系统之中的不同功能层，只有整合发挥不同层的优势，才能够让系统整体发挥出最大的作用。所以我们可以在架构图中看到很多跃层的调用。</p>
<p><img src="https://pic3.zhimg.com/80/v2-dfd59803349ace8c35c569ef7a4348ee_1440w.jpg" alt=""></p>
<p>比如从online 到nearline和offline通过用户消息队列（User Event Queue，现在基本都使用Kafka）来缓存数据流，这是连接online和其他层的接口。</p>
<p>而从nearline和offline中连接online的接口则是algorithm service，online data service，以及model到online层的接口。他们分别存储了算法结果，数据特征和模型文件。</p>
<p>在架构图正中央的存储部分，也有不同的数据库作为数据中心作为不同模块的数据交换接口。比如cassandra更适宜存储大数据量的nosql数据，mysql当然是适合结构化的小数据量数据，而EVcache则作为内存数据库当作数据缓存使用。当然，技术的发展使得现在已经有更合适的技术选型，AWS的dynamoDB，以及redis都可以作为更好的替代方案。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>最后的总结就直接用netflix官方博客的总结吧。</p>
<p>We want the ability to use sophisticated machine learning algorithms that can grow to arbitrary complexity and can deal with huge amounts of data. We also want an architecture that allows for flexible and agile innovation where new approaches can be developed and plugged-in easily. Plus, we want our recommendation results to be fresh and respond quickly to new data and user actions. Finding the sweet spot between these desires is not trivial: it requires a thoughtful analysis of requirements, careful selection of technologies, and a strategic decomposition of recommendation algorithms to achieve the best outcomes for our members.</p>
<p>我们需要具备使用复杂机器学习算法的能力，这些算法要可以适应高度复杂性，可以处理大量数据。我们还要能够提供灵活、敏捷创新的架构，新的方法可以很容易在其基础上开发和插入。而且，我们需要我们的推荐结果足够新，能快速响应新的数据和用户行为。找到这些要求之间恰当的平衡并不容易，需要深思熟虑的需求分析，细心的技术选择，战略性的推荐算法分解，最终才能为客户达成最佳的结果。</p>
<p>能让我拍案叫绝的技术经验不多，上面的标黑部分算是一句，写的多好，我几乎可以认为这是一个工程师乃至架构师的最高境界，与大家共勉。</p>
<hr>
<p>作者：王喆的机器学习笔记<br>文章转自：<a href="https://zhuanlan.zhihu.com/p/114590897" target="_blank" rel="external">https://zhuanlan.zhihu.com/p/114590897</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-05-13</span><i class="fa fa-tag"></i><a href="/tags/Machine-Learning/" title="Machine Learning" class="tag">Machine Learning </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://yoursite.com/2020/05/13/Netflix的推荐系统架构/,Fang-da,Netflix的推荐系统架构,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2020/05/13/移动端开发中渲染流水线(Rendering Pipeline)中的光栅化(Rasterization)/" title="移动端开发中渲染流水线(Rendering Pipeline)中的光栅化(Rasterization)" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2020/05/04/皮尔逊相关系数/" title="皮尔逊相关系数" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>