<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="mariaclark1123@outlook.com"><title>人工智能推荐算法库（二） - Surprise中KNNBaseline算法在电影推荐的应用 · Fang-da</title><meta name="description" content="基线(Baseline)
在计算机术语中，基线(Baseline)是软件文档或源码(或其它产出物)的一个稳定版本，它是进一步开发的基础。
关于基线可以从以下两个方面来理解：
1）代表多个源代码文件的一组稳定版本。 比如有三个文件，aaa.c、bbb.c和ccc.h。可以对这三个文件做一个基线，取aa"><meta name="keywords" content="Hexo,HTML,CSS,android,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/judy.jpg" style="width:160px;"><h3 title><a href="/" style="font-family:medium-ui-sans-serif-text-font,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,Oxygen,Ubuntu,Cantarell,&quot;Open Sans&quot;,&quot;Helvetica Neue&quot;,sans-serif;">Fang-da</a></h3><div class="description"><p>生活一分一秒的过, 你的斗志不是燃烧一刻，而是要每分每秒的燃烧, 即使不燃烧，至少不能让它熄灭。你要的斗志从来都不在逆境中, 而在你做成一件事后这件事能给你带来的成就感以及未来, 那是能指导你每分每秒都燃烧的火药。</p></div></div></div><ul class="social-links"><li><a href="http://facebook.com/mariaclark1123"><i class="fa fa-facebook"></i></a></li><li><a href="http://github.com/mariaclark1123"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"></a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Theme from Fangda&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/albums">相册</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>人工智能推荐算法库（二） - Surprise中KNNBaseline算法在电影推荐的应用</a></h3></div><div class="post-content"><h4 id="基线baseline"><a class="markdownIt-Anchor" href="#基线baseline"></a> 基线(Baseline)</h4>
<p>在计算机术语中，基线(Baseline)是软件文档或源码(或其它产出物)的一个稳定版本，它是进一步开发的基础。</p>
<p><strong>关于基线可以从以下两个方面来理解：</strong></p>
<p>1）代表多个源代码文件的一组稳定版本。 比如有三个文件，aaa.c、bbb.c和ccc.h。可以对这三个文件做一个基线，取aaa.c的版本1.1，取bbb.c的版本1.3，取ccc.h的版本1.0。(1.1,1.3,1.0)就是一个基线。</p>
<p>2）代表文档的一个稳定状态。 比如有一个项目设计文档，当设计基本完成，开发即将开始的时候，需要把这个文档固定下来，内容不能再频繁改变，否则开发人员就无所适从了，可能导致每个人所参照的文档并不是同一个文档。 一个文档如果经过讨论被通过了，被固定了，就可以说这个文档被“基线化”了，然后所有人就可以在这个“基线”的基础上工作。</p>
<p>基线是项目储存库中每个工件版本在特定时期的一个“快照”。它提供一个正式标准，随后的工作基于此标准，并且只有经过授权后才能变更这个标准。建立一个初始基线后，以后每次对其进行的变更都将记录为一个差值，直到建成下一个基线。</p>
<h4 id="knnbaseline的官方说明"><a class="markdownIt-Anchor" href="#knnbaseline的官方说明"></a> KNNBaseline的官方说明</h4>
<p><a href="https://surprise.readthedocs.io/en/stable/knn_inspired.html#surprise.prediction_algorithms.knns.KNNBaseline" target="_blank" rel="noopener">class surprise.prediction_algorithms.knns.KNNBaseline</a></p>
<h4 id="knnbaseline算法在电影推荐的应用例子"><a class="markdownIt-Anchor" href="#knnbaseline算法在电影推荐的应用例子"></a> KNNBaseline算法在电影推荐的应用例子</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> (absolute_import, division, print_function, unicode_literals)</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">from</span> surprise <span class="keyword">import</span> KNNBaseline</span><br><span class="line"><span class="keyword">from</span> surprise <span class="keyword">import</span> Dataset,Reader</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.INFO,</span><br><span class="line">                    format=<span class="string">'%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s'</span>,</span><br><span class="line">                    datefmt=<span class="string">'%a, %d %b %Y %H:%M:%S'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSimModle</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Load the movielens‐100k dataset</span></span><br><span class="line">    file_path = os.path.expanduser(<span class="string">'./u.data'</span>)</span><br><span class="line">    <span class="comment"># 告诉文本阅读器，文本的格式是怎么样的</span></span><br><span class="line">    <span class="comment">#定义一个Reader对象来解析文件或数据框</span></span><br><span class="line">    reader = Reader(line_format=<span class="string">'user item rating timestamp'</span>, sep=<span class="string">'\t'</span>)</span><br><span class="line">    <span class="comment">#从用户文件加载数据文件</span></span><br><span class="line">    data = Dataset.load_from_file(file_path, reader)</span><br><span class="line">    <span class="comment">#获取训练集，这里取数据集全部数据</span></span><br><span class="line">    trainset = data.build_full_trainset()</span><br><span class="line">    <span class="comment">#使用pearson_baseline方式计算相似度  False以item为基准计算相似度 本例为电影之间的相似度</span></span><br><span class="line">    <span class="comment"># Surprise中基于近邻的方法(协同过滤)可以设定不同的度量准则。具体如下：</span></span><br><span class="line">    <span class="comment"># 1：cosine                  用户（items）之间的cosine相似度</span></span><br><span class="line">    <span class="comment"># 2：msd                     用户（items）之间的均方差误差</span></span><br><span class="line">    <span class="comment"># 3：pearson                 用户（items）之间的皮尔逊相关系数</span></span><br><span class="line">    <span class="comment"># 4：pearson_baseline        计算用户（item）之间的（缩小的）皮尔逊相关系数，使用基准值进行居中而不是平均值。</span></span><br><span class="line">    sim_options = &#123;<span class="string">'name'</span>: <span class="string">'pearson_baseline'</span>, <span class="string">'user_based'</span>: <span class="keyword">False</span>&#125;</span><br><span class="line">    bsl_options = &#123;<span class="string">'method'</span>: <span class="string">'als'</span>, <span class="comment">#sgd 随机梯度下降法   #als交替最小二乘法</span></span><br><span class="line">                   <span class="string">'n_epochs'</span>: <span class="number">20</span>,</span><br><span class="line">                   &#125;</span><br><span class="line">    <span class="comment">#使用KNNBaseline算法</span></span><br><span class="line">    <span class="comment">#一种基本的协同过滤算法</span></span><br><span class="line">    <span class="comment"># k(int):要考虑的（最大）邻居数聚合。默认为40个</span></span><br><span class="line">    <span class="comment"># min_k(int):他要考虑的邻居的最少数量聚合，如果没有足够的邻居聚合，设置为零（因此预测结果相当于基线）。默认值为“1”。</span></span><br><span class="line">    <span class="comment"># sim_options:相似性度量的选项字典</span></span><br><span class="line">    <span class="comment"># bsl_options:基线估计的选项字典计算</span></span><br><span class="line">    algo = KNNBaseline(<span class="number">40</span>,<span class="number">1</span>,sim_options=sim_options,bsl_options=bsl_options)</span><br><span class="line">    <span class="comment">#训练模型</span></span><br><span class="line">    algo.fit(trainset)</span><br><span class="line">    <span class="keyword">return</span> algo</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取id到name的互相映射  步骤:2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_item_names</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取电影名到电影id 和 电影id到电影名的映射</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment">#os.path.expanduser(path) 把path中包含的"~"和"~user"转换成用户目录</span></span><br><span class="line">    file_name = (os.path.expanduser(<span class="string">'.'</span>) +<span class="string">'/u.item'</span>)</span><br><span class="line">    rid_to_name = &#123;&#125;</span><br><span class="line">    name_to_rid = &#123;&#125;</span><br><span class="line">    <span class="keyword">with</span> io.open(file_name, <span class="string">'r'</span>, encoding=<span class="string">'ISO-8859-1'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            line = line.split(<span class="string">'|'</span>)</span><br><span class="line">            rid_to_name[line[<span class="number">0</span>]] = line[<span class="number">1</span>]</span><br><span class="line">            name_to_rid[line[<span class="number">1</span>]] = line[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> rid_to_name, name_to_rid</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于之前训练的模型 进行相关电影的推荐  步骤：3</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showSimilarMovies</span><span class="params">(algo, rid_to_name, name_to_rid)</span>:</span></span><br><span class="line">    <span class="comment"># 获得电影Toy Story (1995)的raw_id</span></span><br><span class="line">    toy_story_raw_id = name_to_rid[<span class="string">'Beauty and the Beast (1991)'</span>]  <span class="comment">#Beauty and the Beast(1991)  或  Toy Story (1995)</span></span><br><span class="line">    logging.debug(<span class="string">'raw_id='</span> + toy_story_raw_id)</span><br><span class="line">    <span class="comment">#把电影的raw_id转换为模型的内部id</span></span><br><span class="line">    toy_story_inner_id = algo.trainset.to_inner_iid(toy_story_raw_id)</span><br><span class="line">    <span class="comment">#将信息打印到控制台上</span></span><br><span class="line">    logging.debug(<span class="string">'inner_id='</span> + str(toy_story_inner_id))</span><br><span class="line">    <span class="comment">#通过模型获取推荐电影 这里设置的是10部</span></span><br><span class="line">    toy_story_neighbors = algo.get_neighbors(toy_story_inner_id, <span class="number">10</span>)</span><br><span class="line">    logging.debug(<span class="string">'neighbors_ids='</span> + str(toy_story_neighbors))</span><br><span class="line">    <span class="comment">#模型内部id转换为实际电影id</span></span><br><span class="line">    <span class="comment">#列表表达式</span></span><br><span class="line">    neighbors_raw_ids = [algo.trainset.to_raw_iid(inner_id) <span class="keyword">for</span> inner_id <span class="keyword">in</span> toy_story_neighbors]</span><br><span class="line">    <span class="comment">#通过电影id列表 或得电影推荐列表</span></span><br><span class="line">    neighbors_movies = [rid_to_name[raw_id] <span class="keyword">for</span> raw_id <span class="keyword">in</span> neighbors_raw_ids]</span><br><span class="line">    print(<span class="string">'The 10 nearest neighbors of Toy Story are:'</span>)</span><br><span class="line">    <span class="keyword">for</span> movie <span class="keyword">in</span> neighbors_movies:</span><br><span class="line">        print(movie)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 获取id到name的互相映射</span></span><br><span class="line">    rid_to_name, name_to_rid = read_item_names()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 训练推荐模型</span></span><br><span class="line">    algo = getSimModle()</span><br><span class="line"></span><br><span class="line">    <span class="comment">##显示相关电影</span></span><br><span class="line">    showSimilarMovies(algo, rid_to_name, name_to_rid)</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<pre><code>Estimating biases using als...
Computing the pearson_baseline similarity matrix...
Done computing similarity matrix.
The 10 nearest neighbors of Toy Story are:
Lion King, The (1994)
Toy Story (1995)
Cinderella (1950)
Hunchback of Notre Dame, The (1996)
Sound of Music, The (1965)
Clueless (1995)
Aladdin (1992)
E.T. the Extra-Terrestrial (1982)
Winnie the Pooh and the Blustery Day (1968)
Ghost (1990)
</code></pre>
<hr>
<p>参考文章：<br>
<a href="https://blog.csdn.net/NewBeeMu/article/details/103439674?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-6.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-6.nonecase" target="_blank" rel="noopener">Surprise库使用KNNBaseline算法进行电影推荐</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-07-24</span><i class="fa fa-tag"></i><a href="/tags/Machine-Learning/" title="Machine Learning" class="tag">Machine Learning </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://yoursite.com/2020/07/24/人工智能推荐算法库（二） - Surprise中KNNBaseline算法在电影推荐的应用/,Fang-da,人工智能推荐算法库（二） - Surprise中KNNBaseline算法在电影推荐的应用,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a role="navigation" href="/2020/07/20/人工智能推荐算法（一） - 协同过滤算法介绍/" title="人工智能推荐算法（一） - 协同过滤算法介绍" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>